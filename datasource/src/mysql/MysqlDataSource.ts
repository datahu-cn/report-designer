import {IControl, IDataSource, SourceCode, ITableDefinition} from '@datahu/core'
import {I18n} from '../i18n'
import getControls from './MysqlControls'
import {IMysqlConfig, MysqlHelper} from './MysqlHelper'

export class MysqlDataSource implements IDataSource {
  language: string = 'zh-cn'
  helper: MysqlHelper
  constructor(language: string, config?: object) {
    this.language = language
    var i18n = I18n.get(this.language)
    if (config) this.config = config as IMysqlConfig

    this.helper = new MysqlHelper(this.config)

    // 数据源配置界面的配置控件
    this.controls = getControls(i18n)
    this.title = i18n.mysql_title
    this.description = i18n.mysql_description
  }
  getControls(): IControl[] {
    return this.controls
  }

  controls: IControl[] = []

  // 数据源默认配置值
  config = {
    title: '',
    host: 'localhost',
    port: 3306,
    user: 'root',
    password: '',
    database: '',
    charset: '',
    ssl: false,
    sslCa: '',
    sslKey: '',
    sslCert: '',
    sslRejectUnauthorized: false
  } as IMysqlConfig

  icon: string =
    '<svg t="1612606492096" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1848" width="64" height="64"><path d="M971.5 558.9c-2.4-2.7-4.8-5.1-7-7.8-6.9-10.4-15.2-19.6-24.6-27.1-7.5-5.9-24-14.1-27.2-23.9l-0.4-0.6c5.1-0.5 11.4-2.7 16.2-4.2 8.1-2.4 15.3-2 23.6-4.2 3.7-1.1 7.5-2.4 11.4-3.8v-2.4c-4.2-4.8-7.4-11.4-11.7-16-12.1-12.2-25.2-23.2-38.9-33.1-7.4-5.4-16.8-8.9-24.6-13.4-2.8-1.7-7.5-2.4-9.1-5.1-4.2-5.9-6.7-13.7-9.6-20.6-6.9-15.4-13.3-30.9-19.3-46.8-4.2-10.5-6.9-21.1-12-30.7-24.3-45.8-50.7-73.5-91.2-100.6-8.7-5.6-19.1-8-30.2-11-5.9-0.3-11.7-0.8-17.7-1.1-3.8-2-7.7-6.9-11-9.5-13.5-9.6-48.1-30.6-58-2.9-6.3 17.5 9.4 34.6 14.9 43.5 4.1 6.2 9.1 13.2 12 20.2 1.7 4.7 2.1 9.5 3.8 14.3 3.7 11.9 7.3 25 12.3 36.1 2.6 5.6 5.4 11.6 8.7 16.6 1.8 3 5.1 4.4 5.9 9.2-3.3 5.4-3.6 13.4-5.4 20.2-8.4 30.4-5.1 68 6.9 90.5 3.8 6.6 12.8 21.5 24.8 15.8 10.6-4.8 8.3-20.2 11.4-33.6 0.7-3.2 0.3-5.4 1.7-7.5v0.6c3.3 7.5 6.6 14.8 9.6 22.3 7.3 13.2 19.9 26.9 30.6 36 5.7 4.8 10.2 13.2 17.2 16.1v-0.8h-0.5c-1.5-2.3-3.6-3.5-5.4-5.4-4.5-5-8.6-10.4-12.4-16.1-9.9-15.5-18.7-31.9-26.4-48.9-3.8-8.4-7.1-17.6-10.2-25.9-1.5-3.2-1.5-8-3.8-9.6-3.6 5.9-8.7 11-11.4 18.2-4.5 11.6-4.9 25.9-6.6 40.6-0.9 0.3-0.5 0-0.9 0.6-7.5-2.1-10.2-11-12.9-18.5-7-19.1-8.2-49.8-2.1-71.8 1.7-5.6 8.7-23.5 5.9-28.8-1.5-5.1-6.1-8-8.7-12.2-3.3-5.4-6.2-11.1-8.4-17.2-5.7-15.1-8.4-31.8-14.7-46.8-2.8-6.9-7.8-14.3-11.7-20.6-4.5-7.2-9.4-12.3-12.9-20.9-1.2-3-2.8-7.8-0.9-11 0.5-2.1 1.5-3 3.3-3.6 3.2-2.9 11.9 0.9 14.9 2.6 8.7 4.1 16.1 7.8 23.4 13.4 3.3 2.7 6.9 7.8 11.1 9h4.9c7.5 2 16.1 0.6 23.1 3 12.5 4.5 23.8 11.3 33.9 18.5 31.2 22.7 56.6 54.5 73.5 92 2.8 6.2 4.1 11.9 6.6 18.4 4.9 13.2 11.1 26.6 16.1 39.4 4.9 12.6 9.6 25.6 16.8 36.1 3.6 5.6 17.7 8.6 24 11.4 4.8 2.4 12 4.7 16.2 7.5 8.1 5.6 16 12 23.6 18.2 3.8 3 15.6 9.8 16.4 15.2-18.9-0.6-33.5 1.7-45.8 7.5-3.6 1.7-9.1 1.7-9.6 6.8 2 2.1 2.2 5.6 3.8 8.6 2.8 5.4 7.7 12.6 12.1 16.4 4.9 4.4 9.9 8.7 15.1 12.5 9.1 6.5 19.5 10.2 28.5 16.7 5.1 3.8 10.3 8.6 15.6 12.6 2.6 2 4.2 5.6 7.5 6.9v-0.8c-2-2.6-2.5-6-4.1-8.7zM238.9 555l-47.5 163.5h-0.3L144 555h-40.5C95.8 624.2 87 698.3 85 777.4h36.4c0.7-59.2 0.4-110.8 4.2-169.8h0.4l46.7 169.8h31.4L250 607.5h0.3c5.4 59 5.9 110.6 6.9 169.8h39.4c-1.6-67.1-10.6-141.3-19-222.5h-38.7v0.2zM373.7 745.8c-0.7-9.2-2-16-7.3-37.6l-25.6-95h-38.7l35.8 126.9c5.4 19.1 8.1 31.8 8.1 37.9 0 9-0.5 12.2-3.8 16.9-5.8 5.9-13.3 8.9-22.8 8.9-5.1 0-9.8-0.3-13.6-1.1v27.4c7.9 3.8 14.5 5.6 19.9 5.6 20.2 0 38.8-14.3 55.8-43.2 21.8-37.3 39.3-97.1 52.7-179.4h-37.6c-5.6 50.7-8.7 90-22.9 132.7zM853.7 555h-37.8v222.4h92.8v-34.9h-55zM755.7 762.7c3.2-3 6.2-6.3 9-10.1 15.3-20.3 22.8-50.6 22.8-90.6 0-73.6-25.3-110.5-76-110.5-24.8 0-44.2 9.3-58.2 28-15.2 20.5-22.8 50.6-22.8 90.3 0 39.1 6.7 67.9 20.2 86.1 12.4 16.6 30.9 24.7 55.8 24.7 9.4 0 17.8-1.4 25.6-3.9l46.7 31 12.7-25h-0.1l-35.7-20z m-46-21.4c-13.6 0-23.5-5.9-29.8-17.3v-0.2c-6.9-12.5-10.3-32.7-10.3-60.2 0-48.3 12.9-72.6 38.7-72.6 13.5 0 23.5 5.9 29.7 17.3 6.9 12.6 10.3 32.5 10.3 59.8 0.1 48.7-12.8 73.2-38.6 73.2zM594.2 668.9s-28-18.4-41.8-26.9c-15.2-9.6-24.8-20.9-24.8-34.2 0-8.1 4.6-14.3 10-19.6 5.4-5.6 13.1-8.3 23.1-8.3 12.9 0.2 25.7 6.3 37.5 12.2l7.5-29.7c-14.8-11-31.3-16.6-49.4-16.6-17.7 0-31.9 5.6-43 16.7-11.1 11-21.9 31.6-21.9 49.7 0 21.8 7.4 34.9 22.3 47.4 0 0 27.3 17.9 41.1 26.5 14.8 9.5 22.8 20.8 22.8 34 0.1 9.6-3.8 19-10.6 24.7-6.7 5.9-14.5 3.3-22.3 2.9-12.5-0.6-26.5-4.4-42-13.2l-8.3 25.1c18 13.8 36.3 20.8 55.4 20.8 20.5 0 36.7-6 48.8-18.1 12.1-12 18.2-27.5 18.2-46.5l0.3 0.2c0.1-21.8-7.6-34.9-22.9-47.1z" p-id="1849" fill="#e0620d"></path><path d="M706.9 247.9c-4.1 0.2-6.9 0.6-9.8 1.4v0.5h0.5c1.8 4.2 5.1 7.2 7.5 11 1.8 4.4 3.6 8.6 5.4 12.9l0.5-0.6c3.3-2.7 4.9-6.9 4.9-13.4-1.5-2-1.6-3.8-2.8-5.6-1.1-2.8-4.2-4.1-6.2-6.2z" p-id="1850" fill="#e0620d"></path></svg>'
  title: string = ''
  description: string = ''

  sourceCode: SourceCode = SourceCode.Javascript
  getTables(): Promise<Array<ITableDefinition>> {
    return this.helper.getTables()
  }
  getData(tables: Array<ITableDefinition>): Promise<Array<object>> {
    return this.helper.getData(tables)
  }
}
